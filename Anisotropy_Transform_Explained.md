# å„å‘å¼‚æ€§å˜æ¢çš„æ„ä¹‰ä¸é—®é¢˜ (Anisotropy Transformation Explained)

**åˆ›å»ºæ—¥æœŸ**: 2025å¹´10æœˆ22æ—¥  
**é—®é¢˜**: ç†è§£ä»£ç ä¸­ Line 137 çš„å„å‘å¼‚æ€§å˜æ¢

---

## ğŸ” **é—®é¢˜ä»£ç **

```python
# Line 135-138
u_trans[:, 0] = lambda_ * u_trans[:, 0]  # æ²¿ x è½´æ‹‰ä¼¸
u_norm = np.linalg.norm(u_trans, axis=1, keepdims=True)
u_trans = u_trans / (u_norm + 1e-12)  # é‡æ–°å½’ä¸€åŒ–
```

---

## ğŸ“ **è¿™æ®µä»£ç åšäº†ä»€ä¹ˆï¼Ÿ**

### **å‡ ä½•å˜æ¢ä¸‰æ­¥æ›²**

1. **åˆå§‹çŠ¶æ€**: å•ä½åœ†ä¸Šçš„å‡åŒ€åˆ†å¸ƒç‚¹
   ```
   ç‚¹: (cos Î¸, sin Î¸)ï¼Œå…¶ä¸­ Î¸ ~ Uniform(0, 2Ï€)
   ```

2. **æ‹‰ä¼¸å˜æ¢**: æ²¿ x è½´æ‹‰ä¼¸ Î» å€
   ```
   (x, y) â†’ (Î»x, y)
   ```
   - å¦‚æœ Î» = 2ï¼Œåœ†å˜æˆé•¿è½´åœ¨ x æ–¹å‘çš„æ¤­åœ†
   - æ¤­åœ†åŠé•¿è½´ = Î»ï¼ŒåŠçŸ­è½´ = 1

3. **é‡æ–°å½’ä¸€åŒ–**: å°†æ¤­åœ†ä¸Šçš„ç‚¹æŠ•å½±å›å•ä½åœ†
   ```
   (Î»x, y) â†’ (Î»x, y) / ||(Î»x, y)||
   ```

### **ç»“æœ**

**âš ï¸ ç‚¹çš„åˆ†å¸ƒä¸å†å‡åŒ€ï¼**

---

## ğŸ¯ **ä¸ºä»€ä¹ˆåˆ†å¸ƒå˜å¾—ä¸å‡åŒ€ï¼Ÿ**

### **æ•°å­¦æ¨å¯¼**

åŸå§‹è§’åº¦: $\theta \sim \text{Uniform}(0, 2\pi)$

å˜æ¢åçš„ç‚¹:
$$
\begin{aligned}
x' &= \frac{\lambda \cos\theta}{\sqrt{\lambda^2\cos^2\theta + \sin^2\theta}} \\
y' &= \frac{\sin\theta}{\sqrt{\lambda^2\cos^2\theta + \sin^2\theta}}
\end{aligned}
$$

æ–°è§’åº¦:
$$
\theta' = \arctan\left(\frac{y'}{x'}\right) = \arctan\left(\frac{\sin\theta}{\lambda\cos\theta}\right)
$$

**å…³é”®å‘ç°**: $\theta'$ çš„åˆ†å¸ƒ **ä¸å†å‡åŒ€**ï¼

### **ç›´è§‰è§£é‡Š**

æƒ³è±¡ä¸€ä¸ªåœ†è¢«æ‹‰ä¼¸æˆæ¤­åœ†ï¼Œç„¶ååƒå……æ°”ä¸è¶³çš„æ°”çƒä¸€æ ·"æ”¶ç¼©"å›åœ†å½¢ï¼š

```
    åŸå§‹åœ†              æ‹‰ä¼¸æˆæ¤­åœ†          æŠ•å½±å›åœ†
    
     â€¢  â€¢              â€¢    â€¢              â€¢    â€¢
   â€¢      â€¢          â€¢        â€¢            â€¢  â€¢ â€¢
  â€¢        â€¢   â†’    â€¢          â€¢    â†’        â€¢   
   â€¢      â€¢          â€¢        â€¢            â€¢  â€¢ â€¢
     â€¢  â€¢              â€¢    â€¢              â€¢    â€¢
    å‡åŒ€               æ¤­åœ†              yè½´å¯†åº¦é«˜ï¼
```

- åŸæœ¬åœ¨ **x è½´é™„è¿‘** çš„ç‚¹è¢«"æ‹‰è¿œ"ï¼ŒæŠ•å½±å›æ¥æ—¶è¢«"å‹ç¼©"ï¼Œå¯†åº¦ **é™ä½**
- åŸæœ¬åœ¨ **y è½´é™„è¿‘** çš„ç‚¹ä¿æŒè·ç¦»ï¼ŒæŠ•å½±å›æ¥æ—¶å¯†åº¦ **å¢åŠ **

### **å¯†åº¦å…¬å¼**

æ–°åˆ†å¸ƒçš„å¯†åº¦å‡½æ•°ï¼š
$$
\rho(\theta') = \frac{\lambda}{\lambda^2\cos^2\theta' + \sin^2\theta'}
$$

å½“ $\lambda > 1$:
- $\theta' \approx 0, \pi$ (x è½´): $\rho \approx 1/\lambda < 1$ (å¯†åº¦é™ä½)
- $\theta' \approx \pi/2, 3\pi/2$ (y è½´): $\rho \approx \lambda > 1$ (å¯†åº¦å¢åŠ )

---

## ğŸ¤” **ä¸ºä»€ä¹ˆåŸä»£ç ä¸­æœ‰è¿™ä¸ªå˜æ¢ï¼Ÿ**

### **åœ¨é«˜æ–¯å½’ä¸€åŒ–æ–¹æ³•ä¸­çš„æ„ä¹‰**

åŸå§‹ä»£ç ï¼ˆé«˜æ–¯æ³•ï¼‰:
```python
u = np.random.normal(0, 1, (n, d))  # å„å‘åŒæ€§
u[:, 0] = lambda_ * u[:, 0]         # å˜æˆå„å‘å¼‚æ€§
u_trans = u / ||u||
```

**è¿™é‡Œæœ‰æ„ä¹‰ï¼** å› ä¸ºï¼š

1. **æ”¹å˜åº•å±‚åˆ†å¸ƒ**: å°†å„å‘åŒæ€§é«˜æ–¯å˜æˆå„å‘å¼‚æ€§é«˜æ–¯
   ```
   Î£ = [[1, 0],     â†’    Î£ = [[Î»Â², 0],
        [0, 1]]               [0,  1]]
   ```

2. **ç†è®ºä»·å€¼**: æµ‹è¯•ç®—æ³•åœ¨éå‡åŒ€ç›®æ ‡åˆ†å¸ƒä¸Šçš„è¡¨ç°

3. **ä¿æŒä¸€è‡´æ€§**: åç»­çš„ Langevin åŠ¨åŠ›å­¦å’Œ Koopman ç®—å­ä¼šé€‚åº”è¿™ç§éå‡åŒ€æ€§

### **åœ¨æåæ ‡æ–¹æ³•ä¸­çš„é—®é¢˜**

æ–°ä»£ç ï¼ˆæåæ ‡æ³•ï¼‰:
```python
theta = np.random.uniform(0, 2*np.pi, n)  # ç›®æ ‡ï¼šå‡åŒ€
u_trans = [cos(Î¸), sin(Î¸)]
u_trans[:, 0] = lambda_ * u_trans[:, 0]  # âŒ ç ´åå‡åŒ€æ€§
```

**è‡ªç›¸çŸ›ç›¾ï¼**
- ç”¨æåæ ‡æ˜¯ä¸ºäº† **æ˜¾å¼æ§åˆ¶è§’åº¦åˆ†å¸ƒ**
- ä½†å„å‘å¼‚æ€§å˜æ¢åˆ **éšå¼ç ´åäº†å‡åŒ€æ€§**
- æœ€ç»ˆåˆ†å¸ƒå˜å¾— **ä¸å¯é¢„æµ‹**

---

## âœ… **ä¿®æ”¹å»ºè®®**

### **æ–¹æ¡ˆ 1: ç§»é™¤å„å‘å¼‚æ€§ï¼ˆä¿æŒå‡åŒ€ï¼‰**

```python
theta = np.random.uniform(0, 2*np.pi, n)
u_trans = np.hstack([np.cos(theta), np.sin(theta)])
# ä¸åº”ç”¨ lambda_ å˜æ¢
```

**ä¼˜ç‚¹**:
- æ¸…æ™°çš„å‡åŒ€åˆ†å¸ƒ
- ä¸æåæ ‡æ–¹æ³•çš„åˆè¡·ä¸€è‡´
- æ˜“äºç†è§£å’Œè°ƒè¯•

**ç¼ºç‚¹**:
- ä¸åŸé«˜æ–¯æ³•çš„åˆ†å¸ƒä¸å®Œå…¨ä¸€è‡´

---

### **æ–¹æ¡ˆ 2: æ¡ä»¶åº”ç”¨ï¼ˆå·²å®æ–½ï¼‰**

```python
if lambda_ != 1:
    u_trans[:, 0] = lambda_ * u_trans[:, 0]
    u_trans = u_trans / np.linalg.norm(u_trans, axis=1, keepdims=True)
    label = "anisotropic"
else:
    label = "uniform"
```

**ä¼˜ç‚¹**:
- çµæ´»æ€§ï¼šÎ»=1 æ—¶ä¿æŒå‡åŒ€ï¼ŒÎ»â‰ 1 æ—¶åº”ç”¨å„å‘å¼‚æ€§
- æ¸…æ™°çš„æ ‡ç­¾æŒ‡ç¤ºåˆ†å¸ƒç±»å‹
- æ˜“äºåˆ‡æ¢å’Œæ¯”è¾ƒ

**ç¼ºç‚¹**:
- ä»ç„¶éœ€è¦ç†è§£éå‡åŒ€åˆ†å¸ƒçš„æ€§è´¨

---

### **æ–¹æ¡ˆ 3: ä½¿ç”¨é«˜æ–¯æ³•ï¼ˆåŸå§‹æ–¹æ³•ï¼‰**

å¦‚æœç¡®å®éœ€è¦å„å‘å¼‚æ€§çš„éå‡åŒ€åˆ†å¸ƒï¼Œå»ºè®®ä½¿ç”¨åŸå§‹é«˜æ–¯æ³•ï¼š

```python
u = np.random.normal(0, 1, (n, d))
u[:, 0] = lambda_ * u[:, 0]
u_trans = u / np.linalg.norm(u, axis=1, keepdims=True)
```

**ä¼˜ç‚¹**:
- ç†è®ºåŸºç¡€æ‰å®ï¼ˆMarsaglia å®šç†ï¼‰
- è‡ªç„¶çš„å„å‘å¼‚æ€§
- ä¸åŸä»£ç ä¸€è‡´

**ç¼ºç‚¹**:
- æ²¡æœ‰æ˜¾å¼è§’åº¦

---

## ğŸ“Š **å¯è§†åŒ–éªŒè¯**

è¿è¡Œ `anisotropy_explanation.py` å¯ä»¥çœ‹åˆ°ï¼š

### **Î» = 1 (æ— å„å‘å¼‚æ€§)**
```
å¯†åº¦åˆ†æ:
  é è¿‘ x è½´: ~25%
  é è¿‘ y è½´: ~25%
  å¯†åº¦æ¯”: 1.0 (å‡åŒ€)
```

### **Î» = 2 (å„å‘å¼‚æ€§)**
```
å¯†åº¦åˆ†æ:
  é è¿‘ x è½´: ~15%  â¬‡ï¸ é™ä½
  é è¿‘ y è½´: ~35%  â¬†ï¸ å¢åŠ 
  å¯†åº¦æ¯”: 2.3 (éå‡åŒ€)
```

---

## ğŸ“ **ç†è®ºèƒŒæ™¯**

### **Marsaglia æåæ ‡æ–¹æ³•**

å¯¹äºé«˜æ–¯åˆ†å¸ƒ $\mathbf{X} \sim \mathcal{N}(0, \Sigma)$:
$$
\frac{\mathbf{X}}{||\mathbf{X}||} \text{ çš„åˆ†å¸ƒå–å†³äº } \Sigma
$$

- $\Sigma = I$: çƒé¢å‡åŒ€åˆ†å¸ƒ
- $\Sigma = \text{diag}(\lambda^2, 1)$: çƒé¢éå‡åŒ€åˆ†å¸ƒ

### **é›…å¯æ¯”è¡Œåˆ—å¼**

å˜æ¢ $(r, \theta) \to (x, y)$ çš„é›…å¯æ¯”ï¼š
$$
\frac{\partial(x, y)}{\partial(r, \theta)} = r
$$

ä½†å„å‘å¼‚æ€§å˜æ¢åï¼š
$$
\frac{\partial(x', y')}{\partial(r, \theta)} = \frac{r\lambda}{\sqrt{\lambda^2\cos^2\theta + \sin^2\theta}}
$$

ä¸å†æ˜¯å¸¸æ•° â†’ åˆ†å¸ƒä¸å‡åŒ€ï¼

---

## ğŸ“ **æ€»ç»“**

### **Line 137 çš„æ„ä¹‰**

| ä¸Šä¸‹æ–‡ | æ˜¯å¦æœ‰æ„ä¹‰ | è§£é‡Š |
|--------|----------|------|
| **é«˜æ–¯å½’ä¸€åŒ–æ³•** | âœ… æœ‰æ„ä¹‰ | æ”¹å˜åº•å±‚åˆ†å¸ƒçš„åæ–¹å·® |
| **æåæ ‡æ³•** | âš ï¸ å¯ç–‘ | ç ´åäº†æ˜¾å¼è§’åº¦æ§åˆ¶çš„ä¼˜åŠ¿ |
| **Î» = 1** | âŒ æ— æ„ä¹‰ | æ’ç­‰å˜æ¢ï¼Œå¯åˆ é™¤ |
| **Î» â‰  1** | âš ï¸ éœ€è°¨æ… | å¯¼è‡´éå‡åŒ€åˆ†å¸ƒ |

### **æ¨èè®¾ç½®**

```python
lambda_ = 1  # ä¿æŒå‡åŒ€åˆ†å¸ƒï¼ˆæ¨èï¼‰
```

å¦‚æœéœ€è¦æµ‹è¯•éå‡åŒ€åˆ†å¸ƒï¼Œä½¿ç”¨ï¼š
```python
lambda_ = 2  # æˆ–å…¶ä»–å€¼ > 1
```

å¹¶ç†è§£è¿™ä¼š **å¤§å¹…æ”¹å˜** ç‚¹çš„ç©ºé—´åˆ†å¸ƒï¼

---

## ğŸ“š **å‚è€ƒèµ„æ–™**

1. **Marsaglia, G. (1972)**. "Choosing a Point from the Surface of a Sphere."
2. **Muller, M. E. (1959)**. "A note on a method for generating points uniformly on n-dimensional spheres."
3. ä½ çš„é¡¹ç›®æ–‡æ¡£: `Circle_Sampling_Methods_Explained.md`
